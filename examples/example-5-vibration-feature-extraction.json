[
    {
        "id": "vib_inject",
        "type": "inject",
        "z": "vibration_features_flow",
        "name": "Simulate Vibration (every 100ms)",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "0.1",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 100,
        "wires": [
            [
                "vib_generator"
            ]
        ]
    },
    {
        "id": "vib_generator",
        "type": "function",
        "z": "vibration_features_flow",
        "name": "Vibration Signal Generator",
        "func": "// Simuliere verschiedene Vibrationsmuster\nvar t = context.get('time') || 0;\ncontext.set('time', t + 0.1);\n\n// Basis: Normale Vibration (50 Hz)\nvar normal = 2.0 * Math.sin(2 * Math.PI * 50 * t);\n\n// FÃ¼ge Rauschen hinzu\nvar noise = (Math.random() - 0.5) * 0.5;\n\n// Simuliere Defekt nach 10 Sekunden\nvar defect = 0;\nif (t > 10) {\n    // Impulsive Spikes (simuliert Lagerschaden)\n    if (Math.random() < 0.05) {\n        defect = (Math.random() - 0.5) * 10;\n    }\n}\n\n// Gesamtsignal\nvar value = normal + noise + defect;\n\nmsg.payload = value;\nmsg.unit = \"m/sÂ²\";\nmsg.timestamp = t;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 100,
        "wires": [
            [
                "vib_features_all",
                "vib_features_separate",
                "vib_chart"
            ]
        ]
    },
    {
        "id": "vib_features_all",
        "type": "vibration-features",
        "z": "vibration_features_flow",
        "name": "All Features",
        "windowSize": "100",
        "outputMode": "all",
        "x": 700,
        "y": 80,
        "wires": [
            [
                "vib_debug_all",
                "vib_health_check",
                "vib_dashboard"
            ]
        ]
    },
    {
        "id": "vib_features_separate",
        "type": "vibration-features",
        "z": "vibration_features_flow",
        "name": "Separate Outputs",
        "windowSize": "100",
        "outputMode": "separate",
        "x": 710,
        "y": 200,
        "wires": [
            [
                "vib_rms_chart"
            ],
            [
                "vib_p2p_chart"
            ],
            [
                "vib_cf_chart"
            ],
            [
                "vib_kurt_chart"
            ],
            [
                "vib_skew_chart"
            ],
            []
        ]
    },
    {
        "id": "vib_debug_all",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "All Features Output",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 40,
        "wires": []
    },
    {
        "id": "vib_health_check",
        "type": "function",
        "z": "vibration_features_flow",
        "name": "Health Alert Logic",
        "func": "var features = msg.payload;\n\n// Schwellwerte fÃ¼r Alarme\nvar alerts = [];\n\nif (features.crestFactor > 6) {\n    alerts.push({\n        severity: \"warning\",\n        feature: \"crestFactor\",\n        value: features.crestFactor,\n        message: \"High Crest Factor - Possible impulsive behavior detected\"\n    });\n}\n\nif (features.kurtosis > 3) {\n    alerts.push({\n        severity: \"warning\",\n        feature: \"kurtosis\",\n        value: features.kurtosis,\n        message: \"High Kurtosis - Peaked distribution indicates potential defects\"\n    });\n}\n\nif (features.rms > 5) {\n    alerts.push({\n        severity: \"critical\",\n        feature: \"rms\",\n        value: features.rms,\n        message: \"High RMS - Excessive vibration level\"\n    });\n}\n\nif (features.healthScore < 70) {\n    alerts.push({\n        severity: \"warning\",\n        feature: \"healthScore\",\n        value: features.healthScore,\n        message: \"Low Health Score - Condition deteriorating\"\n    });\n}\n\nif (alerts.length > 0) {\n    msg.payload = {\n        timestamp: Date.now(),\n        alerts: alerts,\n        features: features\n    };\n    return msg;\n}\n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 100,
        "wires": [
            [
                "vib_alert_debug"
            ]
        ]
    },
    {
        "id": "vib_alert_debug",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "âš ï¸ Health Alerts",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1180,
        "y": 100,
        "wires": []
    },
    {
        "id": "vib_dashboard",
        "type": "function",
        "z": "vibration_features_flow",
        "name": "Format for Dashboard",
        "func": "var f = msg.payload;\n\nmsg.payload = {\n    \"RMS\": f.rms.toFixed(3),\n    \"Peak-to-Peak\": f.peakToPeak.toFixed(3),\n    \"Crest Factor\": f.crestFactor.toFixed(2),\n    \"Kurtosis\": f.kurtosis.toFixed(2),\n    \"Skewness\": f.skewness.toFixed(2),\n    \"Health Score\": f.healthScore + \"%\",\n    \"Interpretation\": {\n        \"CF\": f.interpretation.crestFactor,\n        \"Kurt\": f.interpretation.kurtosis,\n        \"Skew\": f.interpretation.skewness\n    }\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 160,
        "wires": [
            [
                "vib_dashboard_debug"
            ]
        ]
    },
    {
        "id": "vib_dashboard_debug",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "ðŸ“Š Dashboard Data",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 160,
        "wires": []
    },
    {
        "id": "vib_chart",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "Raw Vibration Signal",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 40,
        "wires": []
    },
    {
        "id": "vib_rms_chart",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "RMS Trend",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 220,
        "wires": []
    },
    {
        "id": "vib_p2p_chart",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "Peak-to-Peak Trend",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 260,
        "wires": []
    },
    {
        "id": "vib_cf_chart",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "Crest Factor Trend",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 300,
        "wires": []
    },
    {
        "id": "vib_kurt_chart",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "Kurtosis Trend",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 340,
        "wires": []
    },
    {
        "id": "vib_skew_chart",
        "type": "debug",
        "z": "vibration_features_flow",
        "name": "Skewness Trend",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 380,
        "wires": []
    },
    {
        "id": "vib_comment_1",
        "type": "comment",
        "z": "vibration_features_flow",
        "name": "ðŸ“Š Vibration Feature Extraction Example",
        "info": "This example demonstrates comprehensive vibration analysis.\n\n**What it does:**\n- Generates realistic vibration signal\n- Simulates bearing defect after 10 seconds\n- Extracts all vibration features\n- Monitors health indicators\n- Triggers alerts on anomalies\n\n**Features calculated:**\n- RMS (Root Mean Square)\n- Peak-to-Peak amplitude\n- Crest Factor\n- Kurtosis (spikiness)\n- Skewness (asymmetry)\n- Health Score\n\n**Watch for:**\n- Crest Factor increases with defects\n- Kurtosis spikes indicate impacts\n- Health Score drops over time",
        "x": 210,
        "y": 40,
        "wires": []
    },
    {
        "id": "vib_comment_2",
        "type": "comment",
        "z": "vibration_features_flow",
        "name": "ðŸ’¡ Two Output Modes Demonstrated",
        "info": "**All Features Mode (top):**\n- Single output with complete object\n- Good for dashboards\n- Easy to store in database\n\n**Separate Outputs Mode (bottom):**\n- 6 individual outputs\n- Each feature on separate wire\n- Good for downstream processing\n- Easy to route to different charts",
        "x": 200,
        "y": 160,
        "wires": []
    },
    {
        "id": "vib_comment_3",
        "type": "comment",
        "z": "vibration_features_flow",
        "name": "âš ï¸ Alert Logic",
        "info": "Health alerts are triggered when:\n\n- **Crest Factor > 6**: Impulsive behavior\n- **Kurtosis > 3**: Peaked distribution (defects)\n- **RMS > 5**: Excessive vibration\n- **Health Score < 70**: Poor condition\n\nAdjust thresholds based on your equipment!",
        "x": 950,
        "y": 60,
        "wires": []
    }
]

